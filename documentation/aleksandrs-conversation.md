Aleksandrs Gusevs 11:45 AM
Hello William,



I'd be happy to take a look at the issue if it's still relevant. To investigate properly, I'll need the structure of the message you're sending to the Apple Push Service, the service worker code, and a way to subscribe to notifications from my own iOS device. I may also need access to connection logs with the Push Service and a way to trigger push messages to my device for testing.



Best regards,
Alex G.

View details
William Labussiere 12:29 PM
Hi Aleksandrs

You can have a look here at the repo if you'd like : https://github.com/Williamlabussiere/navikinder-debug-push

GitHub - Williamlabussiere/navikinder-debug-push
Contribute to Williamlabussiere/navikinder-debug-push development by creating an account on GitHub.
GitHub
You can use this command to push for testing:



curl -X POST https://nqrtkgxqgenflhpijpxa.supabase.co/functions/v1/send-push-notification \
-H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5xcnRrZ3hxZ2VuZmxocGlqcHhhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM2OTY4NzcsImV4cCI6MjA2OTI3Mjg3N30.YFkNt9Zz3pG8uVQj6UmsTCWuOswW7wDRSS5GGmELaXI" \
-H "Content-Type: application/json" \
-d '{
"dose_instance_id": "test-123",
"due_datetime": "2025-01-08T12:00:00Z",
"dose_amount": 1,
"dose_unit": "mg",
"medication_name": "Vitamin A",
"child_name": "Johnson",
"parent_email": "williamlabussiere@gmail.com",
"parent_name": "William Labussiere"
}'

Production PWA URL:
https://navikinder.com



Key Code Files:
### Service Worker public/sw.js):
- Handles push events, notification display, and PWA caching
- Currently configured for iOS compatibility with event.waitUntil() wrapping
- Includes debug logging for troubleshooting



### Push Subscription Hook src/hooks/usePushNotifications.tsx):
- Manages VAPID key configuration and subscription creation
- Handles permission requests and error logging
- Includes iOS endpoint detection



### Backend Edge Functions:
- supabase/functions/send-push-notification/index.ts - Main push sending logic
- supabase/functions/send-medication-reminder/index.ts - Triggers push notifications



### PWA Configuration:
- public/manifest.json - PWA manifest with iOS-specific settings
- index.html - Meta tags and Apple touch icons



If from what you see you're confident in being able to fix the issue I'll activate the contract

Navikinder
Track and manage your child's medications with reminders
Aleksandrs Gusevs 1:26 PM
Thanks, I'm starting with the task.

Aleksandrs Gusevs 3:18 PM
https://github.com/Williamlabussiere/navikinder-debug-push/pull/1

Update index.ts by flancer64 ¬∑ Pull Request #1 ¬∑ Williamlabussiere/navikinder-debug-push
notificationPayload is restructured.
GitHub
William Labussiere 3:51 PM
Hey Aleksandrs
Thanks for your feedback
I tried but it did not fix the issue unfortunately

I will try in an other way
Maybe integrating OneSignal

Aleksandrs Gusevs 4:04 PM
I have created the test app to check the solution - https://svelters.dev.wiredgeese.com/
You can try to test it with your Apple device. Perhaps the device configuration is the reason. You can save the subscription data from browser as a JSON file and use these scripts to install a nodejs app and check the push notification runs right. Or you can post your subscription data here and I can send a message to you. You already have the web-pushlibrary in your project. It works perfectly.

Push Test
3 files 

Attachment_1754481414432814.jpg
166 kB
package.json
329 bytes
send.js
934 bytes
William Labussiere 4:18 PM
You mean this?

push_subscriptions_rows.json 
push_subscriptions_rows.json
705 bytes
This is the subscription linked to my phone right now

Aleksandrs Gusevs 4:23 PM
No. The subscrption data is like this:

{
  "endpoint": "https://fcm.googleapis.com/fcm/send/d2fVmK2a1Es:APA91bE28rsrvhRUjTmfS8Ta7Hq0kKfT_ZiZ2jbYtNKnvDafB-Akh6GFFxa9aH3llnY59yk6vIWfaa0P7bmGlkBUxqCTwiBSFhHKMqGZHp0xeGWyJB9igq02FpLsjgRomY0BT7Rczd3f",
  "expirationTime": null,
  "keys": {
    "p256dh": "BKjJ3oTzQDAODBVHn_jpZaGlU62aRaoKowcHvzPatS1L8Nvkh4SRPn1S28xM7MVh1SigktVSaYKuSKWqjO9B0aU",
    "auth": "EOrILbq5NJwGKgwaZM22eg"
  }
}

2 files 
Screenshot at 2025-08-06 15-21-42.png
Screenshot at 2025-08-06 15-21-03.png
You need to click the button "Subscribe for Push" then to allow the notifications. After that the subscription data will be generated by your platform (google or apple). Save the subscription data into a file (or DB) and use it when sending the push notification to a user.

You can send a push notification using this subscription file to my chrome browser on my laptop using the send.jsfile with VAPID private & public keys (I have used the public key on subscription in my chrome browser).

Also you can use this subscription data:

{
  "endpoint": "https://web.push.apple.com/QBANO9XErWNa8hdHQ0k-fKNl9EtNC0e2iQ03h8nG4kMYbBCz0GSbH2YX2f6PsXv5xb14PgFZsyWQ6VkmBGyH4lVJICdtaPtI_VZKG6fLMfdnXZWgktFOFNXhKqgjGvcjkqRn41qQ_T03TSjF6LzDeBRiBd7VgNXiANeGeTKvP4w",
  "keys": {
    "p256dh": "BHaxAz86ykgPGA35Pj5zFXM8tBU6sbOwNitFOkRziMvKopz3_fqmyFT2wCfgjS7baG8AHvl69QdbEPNK_Lwz3hc",
    "auth": "-pQUIqYpQpDZEN7LMamzSA"
  }
}
to send a notification to my iOS device (with the same send.jsand the same VAPID keys).



So, if you can subscribe your device on my test site and send a push msg to yourself, so the device is OK and the problem is in your code supabase/functions/send-push-notification/index.ts). You can add a payload and request props to the send.jsuntil it breaks or you can remove extra props from your index.tsuntill it starts working.

William Labussiere 4:38 PM
Here you go



{
"endpoint": "https://web.push.apple.com/QNlRASygW_sSbHY09rDH04ksRQ-QiChzxZlSiSaxbSUOiQdy-3F4oSP9j1LFD4L9Q68uhq0UZS53xUbBkE5pEvXwzoBMzp6pLUxKtxbWkFQQA_CXw8j6iH4u4qDurWXK0_HdT6Zn65Ah0me4Z6T86Lq5c1XvjIA63d55FLI-tog",
"keys": {
"p256dh": "BKlcPt3NAF/YIesOfFmQJ2crpi99sL7yZxTT9XWnLLzWGQVdhMGL0FSJ4z23dObdHfwXubFNIsiifX2yrIQPOIQ=",
"auth": "tSv1Nw/6WF4tVbdXcYNWGQ=="
}
}

With this you‚Äôre supposed to be able to send me a push that‚Äôs correct?

Aleksandrs Gusevs 4:42 PM
I have the error:

  body: '{"reason":"VapidPkHashMismatch"}',
  endpoint: 'https://web.push.apple.com/QNlRASygW_sSbHY09rDH04ksRQ-QiChzxZlSiSaxbSUOiQdy-3F4oSP9j1LFD4L9Q68uhq0UZS53xUbBkE5pEvXwzoBMzp6pLUxKtxbWkFQQA_CXw8j6iH4u4qDurWXK0_HdT6Zn65Ah0me4Z6T86Lq5c1XvjIA63d55FLI-tog'
}
It means I don't have the corresponded VAPID keys for this subacription data. Is this data from your app or from my test app?

William Labussiere 4:43 PM
Ok ok sorry

{
"endpoint": "https://web.push.apple.com/QIoG_7p8E6goT2RDYjrYLwvFthBZrzO6eXUsGROYz8z-tbxSpgpLt0aWfA_ty0rSlBoUAMSPrxVijfB4DxHe0vsVI1QXpTC2YHykJhDLSSE8Y1POIgrgbBaC-sEBe_HTcf1A1-ufJSNBY49tWqdgV9FKwfv3x93TtudTAGI6Gxc",
"keys": {
"p256dh": "BASWjCrBzqbdQ158kdjhyCInMFp5fj5DWKBj76MVr_AGJyj_uiRNnoFlXpfiCIWTZ0HUrI58EGp-khhq0sg503g",
"auth": "pJDJ8aMF_M3wJinrwpSuhw"
}
}

Here is the data from your app

Aleksandrs Gusevs 4:44 PM
Done.

William Labussiere 4:44 PM
I have received the push indeed

Aleksandrs Gusevs 4:44 PM
üëç